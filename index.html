import React, { useState } from 'react';
import { DollarSign, TrendingUp, TrendingDown, Download } from 'lucide-react';

const StaffingCashFlow = () => {
  const weeks = Array.from({ length: 13 }, (_, i) => `Week ${i + 1}`);
  
  const [openingBalance, setOpeningBalance] = useState(50000);
  
  // Revenue categories
  const [data, setData] = useState({
    tempStaffingRevenue: Array(13).fill(45000),
    permPlacementFees: Array(13).fill(15000),
    contractStaffing: Array(13).fill(25000),
    
    // Operating Expenses
    recruiterSalaries: Array(13).fill(12000),
    adminSalaries: Array(13).fill(6000),
    salesSalaries: Array(13).fill(8000),
    payrollTaxes: Array(13).fill(4000),
    
    // Contractor Costs
    contractorPayroll: Array(13).fill(35000),
    contractorBenefits: Array(13).fill(3500),
    workersComp: Array(13).fill(2000),
    
    // Operating Costs
    officeRent: Array(13).fill(3500),
    software: Array(13).fill(800),
    marketing: Array(13).fill(2000),
    insurance: Array(13).fill(1200),
    utilities: Array(13).fill(400),
    
    // Other
    loanPayment: Array(13).fill(0),
    taxPayments: Array(13).fill(0),
    equipmentPurchases: Array(13).fill(0),
  });

  const updateValue = (category, weekIndex, value) => {
    const newData = { ...data };
    newData[category][weekIndex] = parseFloat(value) || 0;
    setData(newData);
  };

  const calculateWeeklyCashFlow = () => {
    const results = [];
    let runningBalance = openingBalance;

    for (let i = 0; i < 13; i++) {
      const totalRevenue = 
        data.tempStaffingRevenue[i] +
        data.permPlacementFees[i] +
        data.contractStaffing[i];

      const totalExpenses =
        data.recruiterSalaries[i] +
        data.adminSalaries[i] +
        data.salesSalaries[i] +
        data.payrollTaxes[i] +
        data.contractorPayroll[i] +
        data.contractorBenefits[i] +
        data.workersComp[i] +
        data.officeRent[i] +
        data.software[i] +
        data.marketing[i] +
        data.insurance[i] +
        data.utilities[i] +
        data.loanPayment[i] +
        data.taxPayments[i] +
        data.equipmentPurchases[i];

      const netCashFlow = totalRevenue - totalExpenses;
      const closingBalance = runningBalance + netCashFlow;

      results.push({
        revenue: totalRevenue,
        expenses: totalExpenses,
        netCashFlow,
        openingBalance: runningBalance,
        closingBalance,
      });

      runningBalance = closingBalance;
    }

    return results;
  };

  const results = calculateWeeklyCashFlow();
  const lowestBalance = Math.min(...results.map(r => r.closingBalance));
  const highestBalance = Math.max(...results.map(r => r.closingBalance));

  const formatCurrency = (value) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex items-center justify-between mb-6">
            <div>
              <h1 className="text-3xl font-bold text-slate-800 mb-2">13-Week Cash Flow Forecast</h1>
              <p className="text-slate-600">Staffing Agency Financial Planning</p>
            </div>
            <DollarSign className="w-12 h-12 text-blue-600" />
          </div>

          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div className="bg-blue-50 rounded-lg p-4">
              <div className="text-sm text-slate-600 mb-1">Opening Balance</div>
              <input
                type="number"
                value={openingBalance}
                onChange={(e) => setOpeningBalance(parseFloat(e.target.value) || 0)}
                className="text-2xl font-bold text-blue-600 bg-transparent border-b border-blue-300 w-full outline-none"
              />
            </div>
            <div className="bg-green-50 rounded-lg p-4">
              <div className="text-sm text-slate-600 mb-1">Highest Balance</div>
              <div className="text-2xl font-bold text-green-600">{formatCurrency(highestBalance)}</div>
            </div>
            <div className="bg-orange-50 rounded-lg p-4">
              <div className="text-sm text-slate-600 mb-1">Lowest Balance</div>
              <div className="text-2xl font-bold text-orange-600">{formatCurrency(lowestBalance)}</div>
            </div>
            <div className="bg-purple-50 rounded-lg p-4">
              <div className="text-sm text-slate-600 mb-1">Final Balance</div>
              <div className="text-2xl font-bold text-purple-600">{formatCurrency(results[12]?.closingBalance || 0)}</div>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6 overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className="border-b-2 border-slate-200">
                <th className="text-left py-3 px-2 font-semibold text-slate-700 sticky left-0 bg-white z-10">Category</th>
                {weeks.map((week, idx) => (
                  <th key={idx} className="text-right py-3 px-2 font-semibold text-slate-700 min-w-[100px]">{week}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              <tr className="bg-slate-50">
                <td colSpan={14} className="py-2 px-2 font-bold text-slate-700 sticky left-0 bg-slate-50">CASH INFLOWS</td>
              </tr>
              
              <tr className="border-b border-slate-100 hover:bg-blue-50">
                <td className="py-2 px-2 sticky left-0 bg-white">Temp Staffing Revenue</td>
                {data.tempStaffingRevenue.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('tempStaffingRevenue', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>
              
              <tr className="border-b border-slate-100 hover:bg-blue-50">
                <td className="py-2 px-2 sticky left-0 bg-white">Permanent Placement Fees</td>
                {data.permPlacementFees.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('permPlacementFees', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>
              
              <tr className="border-b border-slate-100 hover:bg-blue-50">
                <td className="py-2 px-2 sticky left-0 bg-white">Contract Staffing</td>
                {data.contractStaffing.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('contractStaffing', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="bg-green-50 font-semibold">
                <td className="py-2 px-2 sticky left-0 bg-green-50">Total Revenue</td>
                {results.map((result, idx) => (
                  <td key={idx} className="py-2 px-2 text-right text-green-700">{formatCurrency(result.revenue)}</td>
                ))}
              </tr>

              <tr className="bg-slate-50">
                <td colSpan={14} className="py-2 px-2 font-bold text-slate-700 sticky left-0 bg-slate-50">CASH OUTFLOWS</td>
              </tr>

              <tr className="bg-slate-100">
                <td className="py-2 px-2 font-semibold sticky left-0 bg-slate-100">Internal Payroll</td>
              </tr>
              
              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Recruiter Salaries</td>
                {data.recruiterSalaries.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('recruiterSalaries', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Admin Salaries</td>
                {data.adminSalaries.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('adminSalaries', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Sales Salaries</td>
                {data.salesSalaries.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('salesSalaries', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Payroll Taxes</td>
                {data.payrollTaxes.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('payrollTaxes', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="bg-slate-100">
                <td className="py-2 px-2 font-semibold sticky left-0 bg-slate-100">Contractor Costs</td>
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Contractor Payroll</td>
                {data.contractorPayroll.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('contractorPayroll', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Contractor Benefits</td>
                {data.contractorBenefits.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('contractorBenefits', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Workers Compensation</td>
                {data.workersComp.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('workersComp', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="bg-slate-100">
                <td className="py-2 px-2 font-semibold sticky left-0 bg-slate-100">Operating Expenses</td>
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Office Rent</td>
                {data.officeRent.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('officeRent', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Software & ATS</td>
                {data.software.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('software', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Marketing & Advertising</td>
                {data.marketing.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('marketing', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Insurance</td>
                {data.insurance.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('insurance', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Utilities</td>
                {data.utilities.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('utilities', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="bg-slate-100">
                <td className="py-2 px-2 font-semibold sticky left-0 bg-slate-100">Other Expenses</td>
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Loan Payment</td>
                {data.loanPayment.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('loanPayment', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Tax Payments</td>
                {data.taxPayments.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('taxPayments', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-100 hover:bg-red-50">
                <td className="py-2 px-2 pl-6 sticky left-0 bg-white">Equipment Purchases</td>
                {data.equipmentPurchases.map((val, idx) => (
                  <td key={idx} className="py-2 px-2">
                    <input
                      type="number"
                      value={val}
                      onChange={(e) => updateValue('equipmentPurchases', idx, e.target.value)}
                      className="w-full text-right border border-slate-200 rounded px-2 py-1"
                    />
                  </td>
                ))}
              </tr>

              <tr className="bg-red-50 font-semibold">
                <td className="py-2 px-2 sticky left-0 bg-red-50">Total Expenses</td>
                {results.map((result, idx) => (
                  <td key={idx} className="py-2 px-2 text-right text-red-700">{formatCurrency(result.expenses)}</td>
                ))}
              </tr>

              <tr className="bg-slate-50">
                <td colSpan={14} className="py-2 px-2 font-bold text-slate-700 sticky left-0 bg-slate-50">CASH POSITION</td>
              </tr>

              <tr className="border-b border-slate-200 font-semibold">
                <td className="py-2 px-2 sticky left-0 bg-white">Net Cash Flow</td>
                {results.map((result, idx) => (
                  <td key={idx} className={`py-2 px-2 text-right ${result.netCashFlow >= 0 ? 'text-green-700' : 'text-red-700'}`}>
                    {formatCurrency(result.netCashFlow)}
                  </td>
                ))}
              </tr>

              <tr className="border-b border-slate-200">
                <td className="py-2 px-2 sticky left-0 bg-white">Opening Balance</td>
                {results.map((result, idx) => (
                  <td key={idx} className="py-2 px-2 text-right text-slate-600">{formatCurrency(result.openingBalance)}</td>
                ))}
              </tr>

              <tr className="bg-blue-50 font-bold">
                <td className="py-3 px-2 sticky left-0 bg-blue-50">Closing Balance</td>
                {results.map((result, idx) => (
                  <td key={idx} className={`py-3 px-2 text-right ${result.closingBalance < 0 ? 'text-red-700' : 'text-blue-700'}`}>
                    {formatCurrency(result.closingBalance)}
                  </td>
                ))}
              </tr>
            </tbody>
          </table>
        </div>

        <div className="mt-6 bg-white rounded-lg shadow-lg p-6">
          <h2 className="text-xl font-bold text-slate-800 mb-4">Key Insights</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="p-4 bg-slate-50 rounded-lg">
              <h3 className="font-semibold text-slate-700 mb-2">Cash Flow Trend</h3>
              <p className="text-sm text-slate-600">
                {results[12].closingBalance > openingBalance ? (
                  <span className="flex items-center gap-2 text-green-700">
                    <TrendingUp className="w-4 h-4" />
                    Positive trend - balance increased by {formatCurrency(results[12].closingBalance - openingBalance)}
                  </span>
                ) : (
                  <span className="flex items-center gap-2 text-red-700">
                    <TrendingDown className="w-4 h-4" />
                    Negative trend - balance decreased by {formatCurrency(openingBalance - results[12].closingBalance)}
                  </span>
                )}
              </p>
            </div>
            <div className="p-4 bg-slate-50 rounded-lg">
              <h3 className="font-semibold text-slate-700 mb-2">Cash Runway Alert</h3>
              <p className="text-sm text-slate-600">
                {lowestBalance < 0 ? (
                  <span className="text-red-700">⚠️ Warning: Projected negative balance detected</span>
                ) : lowestBalance < 20000 ? (
                  <span className="text-orange-700">⚠️ Caution: Balance falls below $20,000</span>
                ) : (
                  <span className="text-green-700">✓ Healthy cash reserves maintained</span>
                )}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default StaffingCashFlow;
